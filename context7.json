{
  "$schema": "https://context7.com/schema/context7.json",
  "projectTitle": "@nikitadmitrieff/feedback-chat",
  "description": "AI-powered feedback chatbot widget for Next.js — chat-only, GitHub issue creation, or full autonomous code pipeline (chat → issue → Claude agent → PR → preview → approve)",
  "branch": "main",
  "folders": [
    "docs",
    "packages/widget/src",
    "packages/agent/src"
  ],
  "excludeFolders": [
    "node_modules",
    "dist",
    ".turbo"
  ],
  "excludeFiles": [
    "CHANGELOG.md",
    "LICENSE",
    "package-lock.json"
  ],
  "rules": [
    "feedback-chat has 3 tiers: (1) Chat only — AI conversations with localStorage persistence, needs ANTHROPIC_API_KEY + FEEDBACK_PASSWORD. (2) + GitHub — adds automatic issue creation, needs + GITHUB_TOKEN + GITHUB_REPO. (3) + Pipeline — adds autonomous Claude Code agent that implements feedback as PRs, needs + AGENT_URL + Railway/Docker deployment. Always ask which tier the user needs.",
    "The Tailwind v4 @source directive is MANDATORY. Add `@source \"../node_modules/@nikitadmitrieff/feedback-chat/dist/**/*.js\";` to globals.css after `@import \"tailwindcss\"`. Without this, the widget renders completely unstyled.",
    "FeedbackPanel MUST be in a 'use client' component. It uses useState, useEffect, and sessionStorage.",
    "Import styles.css alongside the component: `import '@nikitadmitrieff/feedback-chat/styles.css'`. Without it, no glassmorphism theme.",
    "AI SDK v6 conventions: use inputSchema (not parameters), stepCountIs() (not maxSteps), toUIMessageStreamResponse() (not toDataStreamResponse()).",
    "react@19.1.0 and 19.1.1 are excluded by @ai-sdk/react — consumer needs react@>=19.1.2.",
    "Three package exports: '@nikitadmitrieff/feedback-chat' (client components), '@nikitadmitrieff/feedback-chat/server' (createFeedbackHandler, createStatusHandler), '@nikitadmitrieff/feedback-chat/styles.css' (styles).",
    "The widget CSS is scoped under .feedback-panel — do not override it with consumer styles.",
    "For pipeline tier: consumer needs AGENT_URL env var pointing to the deployed agent service. Agent needs GITHUB_TOKEN, GITHUB_REPO, WEBHOOK_SECRET, and either CLAUDE_CREDENTIALS_JSON (Max, $0/run) or ANTHROPIC_API_KEY.",
    "The agent Dockerfile uses a multi-stage build — dist/ is compiled in the builder stage, not pre-built. The runtime stage installs git/curl, creates a non-root 'agent' user (Claude Code CLI refuses --dangerously-skip-permissions as root), and writes {hasCompletedOnboarding:true} to ~/.claude.json.",
    "The agent authenticates Claude Code CLI via CLAUDE_CODE_OAUTH_TOKEN env var (not credentials file). This is the only way to use Max OAuth in headless Docker. The agent reads the refreshed access token from ~/.claude/.credentials.json and passes it as CLAUDE_CODE_OAUTH_TOKEN. Requires hasCompletedOnboarding workaround (GitHub issue anthropics/claude-code#8938).",
    "GITHUB_TOKEN must be a Personal Access Token (ghp_ prefix). OAuth tokens (gho_) expire after ~8 hours and will silently break issue creation.",
    "When creating GitHub webhooks via gh api, you MUST use config[content_type]=json. The default is form-urlencoded which the Fastify agent rejects with 415.",
    "Railway CLI workflow: railway init → railway up --detach (creates service) → railway service status --all (find name) → railway service link <name> → railway variables set ... → railway domain. You must link the service before setting variables. Note: railway domain outputs decorated text (emoji + URL) — parse with grep -oE 'https://[^ ]+'. railway service link accepts service name or service ID. Combine railway variables set calls into one command for efficiency.",
    "FeedbackPanel accepts only { isOpen: boolean, onToggle: () => void }. There is no statusUrl prop. Pipeline tracking uses PipelineTracker with its own statusEndpoint prop (defaults to '/api/feedback/status'). Do not add extra props to FeedbackPanel.",
    "createFeedbackHandler accepts optional projectContext string to inject app-specific context into the default system prompt. Show it as a commented-out option in handler examples.",
    "GitHub conventions are fixed: branch naming is feedback/issue-{N}, labels are feedback-bot/auto-implement/in-progress/agent-failed/preview-pending/rejected. Do not change these.",
    "localStorage keys are fixed: feedback_conversations, feedback_conv_{id}, feedback_active_conv. sessionStorage: feedback_password."
  ]
}
